<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vòng Quay Con Số May Mắn - AKW</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Montserrat:wght@400;600;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/Thanhtin5520/VongQuayMayMan/refs/heads/main/LOGO.ico">
  <style>
    body {
      font-family: 'Montserrat', 'Roboto', Arial, sans-serif;
      background: linear-gradient(135deg, #181828 60%, #1a237e 100%);
      color: #00eaff;
      margin: 0;
      padding: 0;
    }
    .main-title, h2, .akw-logo-small {
      font-family: 'Orbitron', 'Montserrat', Arial, sans-serif;
    }
    table {
      font-family: 'Montserrat', 'Roboto', Arial, sans-serif;
      border-collapse: separate;
      border-spacing: 0;
    }
    th, td {
      font-family: 'Montserrat', 'Roboto', Arial, sans-serif;
      font-size: 1.08em;
      line-height: 1.35em;
      vertical-align: middle;
      padding: 8px 10px;
      word-break: break-word;
      text-align: left;
    }
    th {
      font-weight: 700;
      text-align: center;
      background: linear-gradient(90deg, #00eaff 60%, #1a237e 100%);
      color: #181828;
      text-shadow: 0 0 8px #fff, 0 0 2px #00eaff;
    }
    td {
      color: #00eaff;
      background: transparent;
      text-align: left;
    }
    td:first-child, th:first-child {
      text-align: center;
    }
    td:last-child, th:last-child {
      text-align: center;
    }
    /* Ép toàn bộ bảng kết quả dùng Montserrat/Roboto, không Orbitron, không in hoa, không letter-spacing lạ */
    #playersTable td, #playersTable th, #playersTable tr, #playersTable tbody {
      font-family: 'Montserrat', 'Roboto', Arial, sans-serif !important;
      font-variant: normal !important;
      text-transform: none !important;
      letter-spacing: normal !important;
    }
    /* Làm đậm cho cột Số và Tên */
    #playersTable td:first-child, #playersTable td:nth-child(2) {
      font-weight: bold;
    }
    .akw-header, .akw-logo-img {
      font-family: 'Orbitron', Arial, sans-serif;
    }
    button, input, select {
      font-family: 'Montserrat', 'Roboto', Arial, sans-serif;
    }
    /* Tăng chiều cao bảng Danh sách người chơi, không ép chiều cao tuyệt đối 2 bảng */
    #playerList {
      height: 870px;
      max-height: 870px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      padding: 0;
    }
    #playerList h2 {
      margin: 0 0 8px 0;
      padding: 18px 0 0 0;
      flex: 0 0 auto;
    }
    #playersTable {
      table-layout: fixed;
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    #playersTable th, #playersTable td {
      border-right: 2px solid #00eaff;
      box-sizing: border-box;
    }
    #playersTable th:last-child, #playersTable td:last-child {
      border-right: none;
    }
    .table-wrapper {
      width: 100%;
    }
    .header-table th, .body-table td {
      padding: 8px 10px;
      font-family: 'Montserrat', 'Roboto', Arial, sans-serif;
      font-size: 1.08em;
      line-height: 1.35em;
      text-align: left;
      box-sizing: border-box;
    }
    .header-table th {
      background: linear-gradient(90deg, #00eaff 60%, #1a237e 100%);
      color: #181828;
      text-shadow: 0 0 8px #fff, 0 0 2px #00eaff;
      font-weight: 700;
      text-align: center;
    }
    .body-table td {
      color: #00eaff;
      background: transparent;
      text-align: left;
    }
    .body-table td:first-child, .header-table th:first-child {
      text-align: center;
    }
    .body-table td:last-child, .header-table th:last-child {
      text-align: center;
    }
    .body-scroll {
      max-height: 810px;
      overflow-y: auto;
      width: 100%;
      scrollbar-width: thin;
      scrollbar-color: #00eaff #232946;
    }
    .body-scroll::-webkit-scrollbar {
      width: 8px;
      background: #232946;
      border-radius: 8px;
    }
    .body-scroll::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #00eaff 40%, #181828 100%);
      border-radius: 8px;
      box-shadow: 0 0 8px #00eaff99;
    }
    .body-scroll::-webkit-scrollbar-thumb:hover {
      background: #00eaff;
    }
  </style>
</head>
<body>
  <header class="akw-header">
    <img src="https://raw.githubusercontent.com/Thanhtin5520/VongQuayMayMan/main/image/W-LOGO-AKW-FULL-WHITE.png" alt="AKW Logo" class="akw-logo-img">
  </header>
  <h1 class="main-title">Vòng Quay Con Số May Mắn <span class="akw-logo-small">AKW</span></h1>
  <div class="container" style="max-width: 1200px; margin: 0 auto; display: flex; flex-direction: row; gap: 40px; align-items: flex-start; justify-content: center;">
    <div id="playerList" style="flex:1 1 0;max-width:50%;background:linear-gradient(135deg,#181828 80%,#1a237e 100%);border-radius:18px;box-shadow:0 0 32px 0 #00eaff55,0 0 0 4px #00eaff33;padding:18px 18px 24px 18px;border:2.5px solid #00eaff;position:relative;overflow:hidden;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;font-size:1.25em;">
      <h2 style="font-family:'Orbitron',Arial,sans-serif;color:#00eaff;font-size:2.2em;letter-spacing:2px;text-shadow:0 0 12px #00eaff,0 0 2px #fff;margin-bottom:18px;text-align:center;display:flex;align-items:center;gap:10px;">
        Danh sách Quý Đại Lý tham gia
      </h2>
      <div class="table-wrapper" style="width:100%;">
        <table id="playersTable" style="width:100%;border-collapse:separate;border-spacing:0;margin:0 auto;background:transparent;border-radius:0;box-shadow:none;font-family:'Orbitron','Courier New',monospace;font-size:1.22em;color:#00eaff;transition:box-shadow 0.3s;table-layout:fixed;">
          <thead>
            <tr>
              <th style="width:12%;min-width:32px;max-width:54px;text-align:center;padding-left:0;padding-right:0;">Số</th>
              <th style="width:58%;min-width:80px;text-align:left;padding-left:12px;padding-right:8px;word-break:break-word;">Tên</th>
              <th style="width:30%;min-width:60px;text-align:center;padding-left:0;padding-right:0;">Kết quả</th>
            </tr>
          </thead>
          <tbody id="players"></tbody>
        </table>
      </div>
    </div>
    <div id="wheel" style="flex:1 1 0;max-width:50%;">
      <h2>Vòng quay số</h2>
      <canvas id="wheelCanvas" width="600" height="600"></canvas>
      <div id="controls">
        <button id="spin">Quay</button>
        <button id="stop">Dừng</button>
      </div>
      <div id="result"></div>
      <div id="successEffect" class="success-effect">
        <div class="spinner"></div>
        <div class="checkmark"></div>
      </div>
      <div id="message"></div>
    </div>
  </div>
  <div id="resultPopup" class="result-popup" style="display:none">
    <div class="result-content">
      <h3>Kết Quả</h3>
      <p id="resultMessage"></p>
    </div>
  </div>
  <audio id="spinAudio" src="./Sound/soundSpin.mp3" preload="auto"></audio>
  <audio id="doneAudio" src="./Sound/done.mp3" preload="auto"></audio>
  <div id="passwordPopup" style="position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(24,24,40,0.98);display:flex;align-items:center;justify-content:center;">
    <div style="background:#181828;border-radius:18px;box-shadow:0 0 32px #00eaff99;padding:36px 32px;display:flex;flex-direction:column;align-items:center;">
      <h2 style="color:#00eaff;font-family:'Orbitron',Arial,sans-serif;margin-bottom:18px;">Nhập mật khẩu truy cập</h2>
      <form id="passwordForm" onsubmit="return false;" style="display:flex;flex-direction:column;align-items:center;">
        <input id="passwordInput" type="password" placeholder="Mật khẩu" style="padding:12px 18px;border-radius:8px;border:2px solid #00eaff;font-size:1.2em;margin-bottom:16px;outline:none;">
        <button id="passwordBtn" type="button" style="padding:10px 32px;border-radius:8px;background:#00eaff;color:#181828;font-weight:bold;font-size:1.1em;border:none;cursor:pointer;">Xác nhận</button>
        <div id="passwordError" style="color:#ff1744;margin-top:10px;display:none;">Sai mật khẩu, vui lòng thử lại!</div>
      </form>
    </div>
  </div>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="script.js"></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      resultPopup.classList.remove('show');
      resultPopup.style.display = 'none';
    });

    const editPrizeBtn = document.getElementById('editPrizeBtn');
    const prizeEditPopup = document.getElementById('prizeEditPopup');
    const closePrizePopup = document.getElementById('closePrizePopup');
    const savePrizeBtn = document.getElementById('savePrizeBtn');
    editPrizeBtn.onclick = () => {
      renderPrizeTablePopup();
      prizeEditPopup.style.display = 'flex';
      prizeEditPopup.classList.add('show');
    };
    function renderPrizeTablePopup() {
      const tbody = document.querySelector('#prizeTablePopup tbody');
      tbody.innerHTML = '';
      if (!window.PRIZES) return;
      window.PRIZES.forEach((prize, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${prize.name}</td><td><img src='${prize.img}' style='height:40px'></td>`;
        tr.style.cursor = 'pointer';
        if (idx === window.selectedPrizeRow) {
          tr.classList.add('active');
          tr.style.background = 'rgba(255, 226, 89, 0.1)';
          tr.style.boxShadow = '0 0 12px rgba(255, 226, 89, 0.3)';
        }
        tr.onclick = () => {
          window.setPrizeByIndex(idx);
          renderPrizeTablePopup();
        };
        tbody.appendChild(tr);
      });
    }
    // Khi quay xong, tự động nhảy lên dòng tiếp theo theo rule mặc định
    window.autoNextPrizeRow = function() {
      // Rule: từ nhỏ đến lớn (Ba dưới -> Ba trên -> Nhì dưới -> Nhì trên -> Nhất)
      const order = [4,3,2,1,0];
      const currentIdx = order.indexOf(window.selectedPrizeRow);
      if (currentIdx < order.length - 1) {
        window.setPrizeByIndex(order[currentIdx+1]);
      }
    };
    closePrizePopup.onclick = () => {
      prizeEditPopup.classList.remove('show');
      setTimeout(() => { prizeEditPopup.style.display = 'none'; }, 300);
    };
    savePrizeBtn.onclick = () => {
      const idx = Number(prizeSelect.value);
      window.setPrizeByIndex && window.setPrizeByIndex(idx);
      prizeEditPopup.classList.remove('show');
      setTimeout(() => { prizeEditPopup.style.display = 'none'; }, 300);
    };
    // Render option động cho prizeSelect
    function renderPrizeSelect() {
      const select = document.getElementById('prizeSelect');
      if (!window.PRIZES) return;
      select.innerHTML = '';
      window.PRIZES.forEach((prize, idx) => {
        const opt = document.createElement('option');
        opt.value = idx;
        opt.textContent = prize.name + (idx === 1 ? ' (trên)' : idx === 2 ? ' (dưới)' : idx === 3 ? ' (trên)' : idx === 4 ? ' (dưới)' : '');
        select.appendChild(opt);
      });
      select.value = window.selectedPrizeRow || 0;
    }
    // Khi chọn combobox, đổi giải và realtime
    document.addEventListener('DOMContentLoaded', () => {
      renderPrizeSelect();
      document.getElementById('prizeSelect').onchange = function() {
        const idx = Number(this.value);
        window.setPrizeByIndex && window.setPrizeByIndex(idx);
      };
    });
    // Khi đổi giải từ socket, cập nhật lại combobox
    if (window.socket) {
      window.socket.on('prizeSelected', (idx) => {
        document.getElementById('prizeSelect').value = idx;
      });
    }

    function syncTableHeaderWidth() {
      const table = document.getElementById('playersTable');
      if (!table) return;
      const ths = table.querySelectorAll('thead th');
      const firstRow = table.querySelector('tbody tr');
      if (!firstRow) return;
      const tds = firstRow.querySelectorAll('td');
      if (tds.length === ths.length) {
        ths.forEach((th, i) => {
          th.style.width = tds[i].offsetWidth + 'px';
        });
      }
    }
    // Gọi lại sau mỗi lần render bảng
    const playersTbody = document.getElementById('players');
    const observer = new MutationObserver(syncTableHeaderWidth);
    observer.observe(playersTbody, { childList: true, subtree: false });
    window.addEventListener('resize', syncTableHeaderWidth);
    setTimeout(syncTableHeaderWidth, 500);
  </script>
  <script>
  (function() {
    const popup = document.getElementById('passwordPopup');
    const input = document.getElementById('passwordInput');
    const btn = document.getElementById('passwordBtn');
    const error = document.getElementById('passwordError');
    const form = document.getElementById('passwordForm');
    if (!popup || !input || !btn || !error || !form) return;
    function checkPassword() {
      if(input.value === '2025') {
        popup.style.display = 'none';
        document.body.style.overflow = '';
      } else {
        error.style.display = 'block';
        input.value = '';
        input.focus();
      }
    }
    btn.onclick = checkPassword;
    form.onsubmit = function(e) { e.preventDefault(); checkPassword(); };
    input.onkeydown = function(e) { if(e.key === 'Enter') checkPassword(); };
    popup.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    input.focus();
  })();
  </script>
  <script>
  // Thay đổi logic hiển thị popup kết quả: tự động ẩn sau 7 giây
  function showResultPopup(message) {
    const resultPopup = document.getElementById('resultPopup');
    const resultMessage = document.getElementById('resultMessage');
    resultMessage.innerHTML = message;
    resultPopup.style.display = 'flex';
    resultPopup.classList.add('show');
    setTimeout(() => {
      resultPopup.classList.remove('show');
      resultPopup.style.display = 'none';
    }, 7000);
  }
  // Gán lại hàm showResultPopup cho các nơi gọi popup kết quả
  window.showResultPopup = showResultPopup;
  </script>
</body>
</html> 