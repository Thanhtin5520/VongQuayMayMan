<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vòng Quay Con Số May Mắn - AKW</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
</head>
<body>   
  <header class="akw-header">
    <img src="https://raw.githubusercontent.com/Thanhtin5520/VongQuayMayMan/main/image/W-LOGO-AKW-FULL-WHITE.png" alt="AKW Logo" class="akw-logo-img">
  </header>
  <h1 class="main-title">Admin - Vòng Quay Con Số May Mắn <span class="akw-logo-small">AKW</span></h1>
  <div class="container" style="max-width: 1200px; margin: 0 auto; display: flex; flex-direction: row; gap: 40px; align-items: flex-start; justify-content: center;">
    <div id="playerList" style="flex:1 1 0;max-width:50%;background:linear-gradient(135deg,#181828 80%,#1a237e 100%);border-radius:18px;box-shadow:0 0 32px 0 #00eaff55,0 0 0 4px #00eaff33;padding:18px 18px 24px 18px;border:2.5px solid #00eaff;position:relative;overflow:hidden;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;font-size:1.25em;">
      <h2 style="font-family:'Orbitron',Arial,sans-serif;color:#00eaff;font-size:2.2em;letter-spacing:2px;text-shadow:0 0 12px #00eaff,0 0 2px #fff;margin-bottom:18px;text-align:center;display:flex;align-items:center;gap:10px;">
        Danh sách người chơi
      </h2>
      <table id="playersTable" style="width:100%;border-collapse:separate;border-spacing:0;margin:0 auto;background:transparent;border-radius:0;box-shadow:none;font-family:'Orbitron','Courier New',monospace;font-size:1.22em;color:#00eaff;transition:box-shadow 0.3s;table-layout:fixed;">
        <thead>
          <tr>
            <th style="width:12%;min-width:32px;max-width:54px;text-align:center;padding-left:0;padding-right:0;">Số</th>
            <th style="width:58%;min-width:80px;text-align:left;padding-left:12px;padding-right:8px;word-break:break-word;">Tên</th>
            <th style="width:30%;min-width:60px;text-align:center;padding-left:0;padding-right:0;">Kết quả</th>
          </tr>
        </thead>
        <tbody id="players"></tbody>
      </table>
    </div>
    <div id="wheel" style="flex:1 1 0;max-width:50%;">
      <h2>Vòng quay số</h2>    
      <canvas id="wheelCanvas" width="600" height="600"></canvas>
      <div id="controls">
        <button id="spin">Quay</button>
        <button id="stop">Dừng</button>
        <button id="reset">Quay lại</button>
      </div>
      <div id="result"></div>
      <div id="successEffect" class="success-effect">
        <div class="spinner"></div>
        <div class="checkmark"></div>
      </div>
      <div id="message"></div>
    </div>
  </div>
  <div id="resultPopup" class="result-popup" style="display:none">
    <div class="result-content">
      <h3>Kết Quả</h3>
      <p id="resultMessage"></p>
      <button id="closeResult">Đóng</button>
    </div>
  </div>
  <audio id="spinAudio" src="./Sound/soundSpin.mp3" preload="auto"></audio>
  <audio id="doneAudio" src="./Sound/done.mp3" preload="auto"></audio>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="script.js"></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      resultPopup.classList.remove('show');
      resultPopup.style.display = 'none';
    });

    closeResult.addEventListener('click', () => {
      resultPopup.classList.remove('show');
      resultPopup.style.display = 'none';
    });

    const editPrizeBtn = document.getElementById('editPrizeBtn');
    const prizeEditPopup = document.getElementById('prizeEditPopup');
    const closePrizePopup = document.getElementById('closePrizePopup');
    const savePrizeBtn = document.getElementById('savePrizeBtn');
    editPrizeBtn.onclick = () => {
      renderPrizeTablePopup();
      prizeEditPopup.style.display = 'flex';
      prizeEditPopup.classList.add('show');
    };
    function renderPrizeTablePopup() {
      const tbody = document.querySelector('#prizeTablePopup tbody');
      tbody.innerHTML = '';
      if (!window.PRIZES) return;
      window.PRIZES.forEach((prize, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${prize.name}</td><td><img src='${prize.img}' style='height:40px'></td>`;
        tr.style.cursor = 'pointer';
        if (idx === window.selectedPrizeRow) {
          tr.classList.add('active');
          tr.style.background = 'rgba(255, 226, 89, 0.1)';
          tr.style.boxShadow = '0 0 12px rgba(255, 226, 89, 0.3)';
        }
        tr.onclick = () => {
          window.setPrizeByIndex(idx);
          renderPrizeTablePopup();
        };
        tbody.appendChild(tr);
      });
    }
    // Khi quay xong, tự động nhảy lên dòng tiếp theo theo rule mặc định
    window.autoNextPrizeRow = function() {
      // Rule: từ nhỏ đến lớn (Ba dưới -> Ba trên -> Nhì dưới -> Nhì trên -> Nhất)
      const order = [4,3,2,1,0];
      const currentIdx = order.indexOf(window.selectedPrizeRow);
      if (currentIdx < order.length - 1) {
        window.setPrizeByIndex(order[currentIdx+1]);
      }
    };
    closePrizePopup.onclick = () => {
      prizeEditPopup.classList.remove('show');
      setTimeout(() => { prizeEditPopup.style.display = 'none'; }, 300);
    };
    savePrizeBtn.onclick = () => {
      const idx = Number(prizeSelect.value);
      window.setPrizeByIndex && window.setPrizeByIndex(idx);
      prizeEditPopup.classList.remove('show');
      setTimeout(() => { prizeEditPopup.style.display = 'none'; }, 300);
    };
    // Render option động cho prizeSelect
    function renderPrizeSelect() {
      const select = document.getElementById('prizeSelect');
      if (!window.PRIZES) return;
      select.innerHTML = '';
      window.PRIZES.forEach((prize, idx) => {
        const opt = document.createElement('option');
        opt.value = idx;
        opt.textContent = prize.name + (idx === 1 ? ' (trên)' : idx === 2 ? ' (dưới)' : idx === 3 ? ' (trên)' : idx === 4 ? ' (dưới)' : '');
        select.appendChild(opt);
      });
      select.value = window.selectedPrizeRow || 0;
    }
    // Khi chọn combobox, đổi giải và realtime
    document.addEventListener('DOMContentLoaded', () => {
      renderPrizeSelect();
      document.getElementById('prizeSelect').onchange = function() {
        const idx = Number(this.value);
        window.setPrizeByIndex && window.setPrizeByIndex(idx);
      };
    });
    // Khi đổi giải từ socket, cập nhật lại combobox
    if (window.socket) {
      window.socket.on('prizeSelected', (idx) => {
        document.getElementById('prizeSelect').value = idx;
      });
    }
  </script>
</body>
</html> 